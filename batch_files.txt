REM build.bat - Windows ë°°ì¹˜ ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸
@echo off
chcp 65001 > nul
echo.
echo ========================================
echo   HWPX ìë™í™” ë„êµ¬ EXE ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸
echo ========================================
echo.

REM ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
net session >nul 2>&1
if %errorlevel% neq 0 (
    echo âš ï¸ ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
    echo.
)

REM Python ì„¤ì¹˜ í™•ì¸
python --version >nul 2>&1
if %errorlevel% neq 0 (
    echo âŒ Pythonì´ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
    echo https://python.orgì—ì„œ Pythonì„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”.
    pause
    exit /b 1
)

echo âœ… Python ì„¤ì¹˜ë¨
python --version

REM ê°€ìƒí™˜ê²½ í™•ì¸ ë° ìƒì„±
if not exist "venv" (
    echo ğŸ“¦ ê°€ìƒí™˜ê²½ ìƒì„± ì¤‘...
    python -m venv venv
    if %errorlevel% neq 0 (
        echo âŒ ê°€ìƒí™˜ê²½ ìƒì„± ì‹¤íŒ¨
        pause
        exit /b 1
    )
)

REM ê°€ìƒí™˜ê²½ í™œì„±í™”
echo ğŸ”„ ê°€ìƒí™˜ê²½ í™œì„±í™”...
call venv\Scripts\activate.bat
if %errorlevel% neq 0 (
    echo âŒ ê°€ìƒí™˜ê²½ í™œì„±í™” ì‹¤íŒ¨
    pause
    exit /b 1
)

REM pip ì—…ê·¸ë ˆì´ë“œ
echo ğŸ“ˆ pip ì—…ê·¸ë ˆì´ë“œ...
python -m pip install --upgrade pip

REM ì˜ì¡´ì„± ì„¤ì¹˜
echo ğŸ“¦ ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜...
if exist "requirements.txt" (
    pip install -r requirements.txt
) else (
    echo requirements.txt ìƒì„±...
    python build_exe.py --requirements
    pip install -r requirements.txt
)

if %errorlevel% neq 0 (
    echo âŒ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì‹¤íŒ¨
    pause
    exit /b 1
)

REM Tesseract ì„¤ì¹˜ í™•ì¸
echo ğŸ” Tesseract í™•ì¸...
where tesseract >nul 2>&1
if %errorlevel% neq 0 (
    echo âš ï¸ Tesseractê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
    echo.
    echo ë‹¤ìŒ ë§í¬ì—ì„œ Tesseractë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”:
    echo https://github.com/UB-Mannheim/tesseract/wiki
    echo.
    set /p choice="Tesseract ì—†ì´ ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n): "
    if /i not "%choice%"=="y" (
        echo ë¹Œë“œ ì·¨ì†Œë¨
        pause
        exit /b 1
    )
) else (
    echo âœ… Tesseract ì„¤ì¹˜ë¨
    tesseract --version | findstr "tesseract"
)

REM ì´ì „ ë¹Œë“œ ì •ë¦¬
if exist "dist" (
    echo ğŸ—‘ï¸ ì´ì „ ë¹Œë“œ íŒŒì¼ ì •ë¦¬...
    rmdir /s /q dist
)
if exist "build" (
    rmdir /s /q build
)
if exist "*.spec" (
    del /q *.spec
)

REM EXE ë¹Œë“œ ì‹¤í–‰
echo.
echo ğŸ—ï¸ EXE ë¹Œë“œ ì‹œì‘...
echo.
python build_exe.py

if %errorlevel% neq 0 (
    echo.
    echo âŒ ë¹Œë“œ ì‹¤íŒ¨!
    echo ì˜¤ë¥˜ë¥¼ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.
    pause
    exit /b 1
)

echo.
echo âœ… ë¹Œë“œ ì™„ë£Œ!
echo ğŸ“ dist í´ë”ì—ì„œ ì‹¤í–‰ íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”.
echo.

REM ê²°ê³¼ í™•ì¸
if exist "dist\HWPX_Automation.exe" (
    for %%I in ("dist\HWPX_Automation.exe") do (
        set "filesize=%%~zI"
    )
    echo ğŸ“ íŒŒì¼ í¬ê¸°: %filesize% bytes
    echo.
    
    set /p choice="ì§€ê¸ˆ ì‹¤í–‰ íŒŒì¼ì„ í…ŒìŠ¤íŠ¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n): "
    if /i "%choice%"=="y" (
        echo ğŸš€ ì‹¤í–‰ íŒŒì¼ ì‹œì‘...
        start "" "dist\HWPX_Automation.exe"
    )
) else (
    echo âŒ ì‹¤í–‰ íŒŒì¼ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
)

echo.
pause